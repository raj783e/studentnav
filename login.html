<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter the Navigator</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="login.css">
</head>

<body>

    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="container">
        <div class="form-side">
            <div class="brand">
                <i class="fa-solid fa-location-dot"></i>
                <span>City Navigator</span>
            </div>

            <h2 id="formTitle">Welcome Back</h2>
            <p class="subtitle" id="formSubtitle">Enter your details to access your account</p>

            <form id="authForm">
                <div class="input-group">
                    <input type="email" id="email" placeholder="Email Address" required>
                    <i class="fa-regular fa-envelope"></i>
                </div>

                <div class="input-group">
                    <input type="password" id="password" placeholder="Password" required>
                    <i class="fa-solid fa-lock"></i>
                </div>

                <button type="submit" class="btn-primary" id="submitBtn">Sign In</button>
            </form>

            <div class="divider">
                <span>OR</span>
            </div>

            <button type="button" class="btn-google" id="googleBtn">
                <i class="fa-brands fa-google"></i>
                <span>Continue with Google</span>
            </button>

            <button type="button" class="btn-guest" id="guestBtn">
                <i class="fa-solid fa-user-secret"></i>
                <span>Continue as Guest</span>
            </button>

            <div id="authMessage"></div>

            <div class="toggle-text">
                <span id="toggleLabel">Don't have an account?</span>
                <a href="#" id="toggleAuth">Sign up</a>
            </div>
        </div>

        <div class="visual-side">
            <div class="floating-card card-1"></div>
            <div class="floating-card card-2"></div>
            <div class="visual-content">
                <h3>Explore Your City</h3>
                <p>Find the best budget-friendly spots, student accommodations, and hidden gems around you.</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <script>
        // Logic
        const auth = firebase.auth();
        const authForm = document.getElementById('authForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const submitBtn = document.getElementById('submitBtn');
        const googleBtn = document.getElementById('googleBtn');
        const guestBtn = document.getElementById('guestBtn');
        const toggleAuthBtn = document.getElementById('toggleAuth');
        const formTitle = document.getElementById('formTitle');
        const formSubtitle = document.getElementById('formSubtitle');
        const toggleLabel = document.getElementById('toggleLabel');
        const authMessage = document.getElementById('authMessage');

        let isLogin = true;

        // Check auth state
        auth.onAuthStateChanged(user => {
            if (user) {
                window.location.href = 'index.html';
            }
        });

        // Toggle Mode
        toggleAuthBtn.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;

            if (isLogin) {
                formTitle.textContent = 'Welcome Back';
                formSubtitle.textContent = 'Enter your details to access your account';
                submitBtn.textContent = 'Sign In';
                toggleLabel.textContent = "Don't have an account?";
                toggleAuthBtn.textContent = 'Sign up';
            } else {
                formTitle.textContent = 'Create Account';
                formSubtitle.textContent = 'Start your journey with us today';
                submitBtn.textContent = 'Sign Up';
                toggleLabel.textContent = "Already have an account?";
                toggleAuthBtn.textContent = 'Sign in';
            }
            authMessage.textContent = '';
        });

        // Handle Email/Password Submit
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;

            authMessage.textContent = '';
            const originalBtnText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            try {
                if (isLogin) {
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                }
            } catch (error) {
                console.error(error);
                let msg = "An error occurred.";
                if (error.code === 'auth/user-not-found') msg = "No account found with this email.";
                else if (error.code === 'auth/wrong-password') msg = "Incorrect password.";
                else if (error.code === 'auth/email-already-in-use') msg = "Email already in use.";
                else if (error.code === 'auth/weak-password') msg = "Password should be at least 6 characters.";
                else if (error.code === 'auth/invalid-email') msg = "Invalid email address.";

                authMessage.textContent = msg;
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            }
        });

        // Handle Google Sign-In
        googleBtn.addEventListener('click', async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            authMessage.textContent = '';

            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error(error);
                authMessage.textContent = "Google Sign-In failed. Please try again.";
            }
        });

        // Handle Guest Access
        if (guestBtn) {
            guestBtn.addEventListener('click', () => {
                localStorage.setItem('guestMode', 'true');
                window.location.href = 'index.html';
            });
        }
    </script>
</body>

</html>